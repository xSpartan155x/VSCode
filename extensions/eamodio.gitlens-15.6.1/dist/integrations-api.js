exports.id=773,exports.ids=[773],exports.modules={7797:(e,r,t)=>{t.r(r),t.d(r,{ProvidersApi:()=>ProvidersApi});var s=t(436),o=t(1517),u=t(1528),n=t.n(u),i=t(1398),a=t(3273),l=t(5648),g=t(1033),c=t(6541);let ProvidersApi=class ProvidersApi{constructor(e,r){this.container=e,this.authenticationService=r;let t=(0,s.cQ)(),u=`${e.debugging?"GitLens-Debug":e.prerelease?"GitLens-Pre":"GitLens"}/${e.version} (${i.env.appName}/${i.version}; ${(0,o.uo)()})`,l=async({url:e,...r})=>d(await (0,s.hd)(e,{agent:t,...r,headers:{"User-Agent":u,...r.headers}})),g=n()({request:l});this.providers={[a.Q7.GitHub]:{...c.Mt[a.Q7.GitHub],provider:g.github,getCurrentUserFn:g.github.getCurrentUser.bind(g.github),getPullRequestsForReposFn:g.github.getPullRequestsForRepos.bind(g.github),getPullRequestsForUserFn:g.github.getPullRequestsAssociatedWithUser.bind(g.github),getIssuesForReposFn:g.github.getIssuesForRepos.bind(g.github)},[a.PY.GitHubEnterprise]:{...c.Mt[a.PY.GitHubEnterprise],provider:g.github,getCurrentUserFn:g.github.getCurrentUser.bind(g.github),getPullRequestsForReposFn:g.github.getPullRequestsForRepos.bind(g.github),getPullRequestsForUserFn:g.github.getPullRequestsAssociatedWithUser.bind(g.github),getIssuesForReposFn:g.github.getIssuesForRepos.bind(g.github)},[a.Q7.GitLab]:{...c.Mt[a.Q7.GitLab],provider:g.gitlab,getCurrentUserFn:g.gitlab.getCurrentUser.bind(g.gitlab),getPullRequestsForReposFn:g.gitlab.getPullRequestsForRepos.bind(g.gitlab),getPullRequestsForRepoFn:g.gitlab.getPullRequestsForRepo.bind(g.gitlab),getPullRequestsForUserFn:g.gitlab.getPullRequestsAssociatedWithUser.bind(g.gitlab),getIssuesForReposFn:g.gitlab.getIssuesForRepos.bind(g.gitlab),getIssuesForRepoFn:g.gitlab.getIssuesForRepo.bind(g.gitlab),mergePullRequestFn:g.gitlab.mergePullRequest.bind(g.gitlab)},[a.PY.GitLabSelfHosted]:{...c.Mt[a.PY.GitLabSelfHosted],provider:g.gitlab,getCurrentUserFn:g.gitlab.getCurrentUser.bind(g.gitlab),getPullRequestsForReposFn:g.gitlab.getPullRequestsForRepos.bind(g.gitlab),getPullRequestsForRepoFn:g.gitlab.getPullRequestsForRepo.bind(g.gitlab),getPullRequestsForUserFn:g.gitlab.getPullRequestsAssociatedWithUser.bind(g.gitlab),getIssuesForReposFn:g.gitlab.getIssuesForRepos.bind(g.gitlab),getIssuesForRepoFn:g.gitlab.getIssuesForRepo.bind(g.gitlab)},[a.Q7.Bitbucket]:{...c.Mt[a.Q7.Bitbucket],provider:g.bitbucket,getCurrentUserFn:g.bitbucket.getCurrentUser.bind(g.bitbucket),getPullRequestsForReposFn:g.bitbucket.getPullRequestsForRepos.bind(g.bitbucket),getPullRequestsForUserFn:g.bitbucket.getPullRequestsForUser.bind(g.bitbucket),getPullRequestsForRepoFn:g.bitbucket.getPullRequestsForRepo.bind(g.bitbucket)},[a.Q7.AzureDevOps]:{...c.Mt[a.Q7.AzureDevOps],provider:g.azureDevOps,getCurrentUserFn:g.azureDevOps.getCurrentUser.bind(g.azureDevOps),getCurrentUserForInstanceFn:g.azureDevOps.getCurrentUserForInstance.bind(g.azureDevOps),getAzureResourcesForUserFn:g.azureDevOps.getOrgsForUser.bind(g.azureDevOps),getAzureProjectsForResourceFn:g.azureDevOps.getAzureProjects.bind(g.azureDevOps),getPullRequestsForReposFn:g.azureDevOps.getPullRequestsForRepos.bind(g.azureDevOps),getPullRequestsForRepoFn:g.azureDevOps.getPullRequestsForRepo.bind(g.azureDevOps),getPullRequestsForAzureProjectsFn:g.azureDevOps.getPullRequestsForProjects.bind(g.azureDevOps),getIssuesForAzureProjectFn:g.azureDevOps.getIssuesForAzureProject.bind(g.azureDevOps),getReposForAzureProjectFn:g.azureDevOps.getReposForAzureProject.bind(g.azureDevOps)},[a.tp.Jira]:{...c.Mt[a.tp.Jira],provider:g.jira,getCurrentUserForResourceFn:g.jira.getCurrentUserForResource.bind(g.jira),getJiraResourcesForCurrentUserFn:g.jira.getJiraResourcesForCurrentUser.bind(g.jira),getJiraProjectsForResourcesFn:g.jira.getJiraProjectsForResources.bind(g.jira),getIssueFn:g.jira.getIssue.bind(g.jira),getIssuesForProjectFn:g.jira.getIssuesForProject.bind(g.jira),getIssuesForResourceForCurrentUserFn:g.jira.getIssuesForResourceForCurrentUser.bind(g.jira)},[a.tp.Trello]:{...c.Mt[a.tp.Trello],provider:g.trello}}}providers;getScopesForProvider(e){return this.providers[e]?.scopes}getProviderDomain(e){return this.providers[e]?.domain}getProviderPullRequestsPagingMode(e){return this.providers[e]?.pullRequestsPagingMode}getProviderIssuesPagingMode(e){return this.providers[e]?.issuesPagingMode}providerSupportsPullRequestFilters(e,r){return this.providers[e]?.supportedPullRequestFilters!=null&&r.every(r=>this.providers[e]?.supportedPullRequestFilters?.includes(r))}providerSupportsIssueFilters(e,r){return this.providers[e]?.supportedIssueFilters!=null&&r.every(r=>this.providers[e]?.supportedIssueFilters?.includes(r))}isRepoIdsInput(e){return null!=e&&Array.isArray(e)&&e.every(e=>"string"==typeof e||"number"==typeof e)}async getProviderToken(e,r){let t=null==e.domain||null==e.scopes?void 0:{domain:e.domain,scopes:e.scopes};try{let s=await this.authenticationService.get(e.id);return(await s.getSession(t,{createIfNeeded:r?.createSessionIfNeeded}))?.accessToken}catch{return}}getAzurePATForOAuthToken(e){return(0,g.K3)(`PAT:${e}`)}async ensureProviderTokenAndFunction(e,r,t){let s=this.providers[e];if(null==s)throw Error(`Provider with id ${e} not registered`);let o=t??await this.getProviderToken(s);if(null==o)throw Error(`Not connected to provider ${e}`);if(null==s[r])throw Error(`Provider with id ${e} does not support function: ${r}`);return{provider:s,token:o}}handleProviderError(e,r,t){if(null==this.providers[e])throw Error(`Provider with id ${e} not registered`);if(e===a.tp.Jira&&t?.response?.status!=null){if(401===t.response.status)throw new l.v3(e,l.R.Forbidden,t);if(429===t.response.status){let e;let s=t.response.headers?.["x-ratelimit-reset"];throw null!=s&&Number.isNaN(e=parseInt(s,10))&&(e=void 0),new l.HG(t,r,e)}if(t.response.status>=400&&t.response.status<500)throw new l.tk(t)}throw t}async getPagedResult(e,r,t,s,o="{}",u=!1){let n;try{n=JSON.parse(o)}catch{n={}}let i=n.value,a=n.type,l={};"page"===a?l={page:i}:"cursor"===a&&(l={cursor:i});let g={...r,...l},c=await t?.(g,{token:s,isPAT:u});if(null==c)return{values:[]};let d=c.pageInfo?.hasNextPage??!1,F="{}";return c.pageInfo?.endCursor!=null?F=JSON.stringify({value:c.pageInfo?.endCursor,type:"cursor"}):c.pageInfo?.nextPage!=null&&(F=JSON.stringify({value:c.pageInfo?.nextPage,type:"page"})),{values:c.data,paging:{cursor:F,more:d}}}async getCurrentUser(e,r){let{provider:t,token:s}=await this.ensureProviderTokenAndFunction(e,"getCurrentUserFn",r?.accessToken);try{return(await t.getCurrentUserFn?.({},{token:s,isPAT:r?.isPAT}))?.data}catch(r){return this.handleProviderError(e,s,r)}}async getCurrentUserForInstance(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getCurrentUserForInstanceFn",t?.accessToken);return(await s.getCurrentUserForInstanceFn?.({namespace:r},{token:o,isPAT:t?.isPAT}))?.data}async getCurrentUserForResource(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getCurrentUserForResourceFn",t?.accessToken);try{return(await s.getCurrentUserForResourceFn?.({resourceId:r},{token:o}))?.data}catch(r){return this.handleProviderError(e,o,r)}}async getJiraResourcesForCurrentUser(e){let{provider:r,token:t}=await this.ensureProviderTokenAndFunction(a.tp.Jira,"getJiraResourcesForCurrentUserFn",e?.accessToken);try{return(await r.getJiraResourcesForCurrentUserFn?.({token:t}))?.data}catch(e){return this.handleProviderError(a.tp.Jira,t,e)}}async getAzureResourcesForUser(e,r){let{provider:t,token:s}=await this.ensureProviderTokenAndFunction(a.Q7.AzureDevOps,"getAzureResourcesForUserFn",r?.accessToken);try{return(await t.getAzureResourcesForUserFn?.({userId:e},{token:s}))?.data}catch(e){return this.handleProviderError(a.Q7.AzureDevOps,s,e)}}async getJiraProjectsForResources(e,r){let{provider:t,token:s}=await this.ensureProviderTokenAndFunction(a.tp.Jira,"getJiraProjectsForResourcesFn",r?.accessToken);try{return(await t.getJiraProjectsForResourcesFn?.({resourceIds:e},{token:s}))?.data}catch(e){return this.handleProviderError(a.tp.Jira,s,e)}}async getAzureProjectsForResource(e,r){let{provider:t,token:s}=await this.ensureProviderTokenAndFunction(a.Q7.AzureDevOps,"getAzureProjectsForResourceFn",r?.accessToken),o=r?.isPAT?s:this.getAzurePATForOAuthToken(s);try{return await this.getPagedResult(t,{namespace:e,...r},t.getAzureProjectsForResourceFn,o,r?.cursor,!0)}catch(e){return this.handleProviderError(a.Q7.AzureDevOps,s,e)}}async getReposForAzureProject(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(a.Q7.AzureDevOps,"getReposForAzureProjectFn",t?.accessToken);return this.getPagedResult(s,{namespace:e,project:r,...t},s.getReposForAzureProjectFn,o,t?.cursor)}async getPullRequestsForRepos(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getPullRequestsForReposFn",t?.accessToken);return this.getPagedResult(s,{...this.isRepoIdsInput(r)?{repoIds:r}:{repos:r},...t},s.getPullRequestsForReposFn,o,t?.cursor)}async getPullRequestsForRepo(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getPullRequestsForRepoFn",t?.accessToken);return this.getPagedResult(s,{repo:r,...t},s.getPullRequestsForRepoFn,o,t?.cursor)}async getPullRequestsForUser(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getPullRequestsForUserFn",t?.accessToken);return this.getPagedResult(s,{...e===a.Q7.Bitbucket?{userId:r}:{username:r},...t},s.getPullRequestsForUserFn,o,t?.cursor)}async getPullRequestsForAzureProjects(e,r){let{provider:t,token:s}=await this.ensureProviderTokenAndFunction(a.Q7.AzureDevOps,"getPullRequestsForAzureProjectsFn",r?.accessToken),o=r?.isPAT?s:this.getAzurePATForOAuthToken(s);try{return(await t.getPullRequestsForAzureProjectsFn?.({projects:e,...r},{token:o,isPAT:!0}))?.data}catch(e){return this.handleProviderError(a.Q7.AzureDevOps,s,e)}}async mergePullRequest(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"mergePullRequestFn"),u=r.refs?.head;if(null==u)return!1;try{return await s.mergePullRequestFn?.({pullRequest:{headRef:{oid:u.sha},id:r.id,number:Number.parseInt(r.id,10),repository:{id:r.repository.repo,name:r.repository.repo,owner:{login:r.repository.owner}}},...t},{token:o}),!0}catch(r){return this.handleProviderError(e,o,r)}}async getIssuesForRepos(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getIssuesForReposFn",t?.accessToken);return this.getPagedResult(s,{...this.isRepoIdsInput(r)?{repoIds:r}:{repos:r},...t},s.getIssuesForReposFn,o,t?.cursor)}async getIssuesForRepo(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getIssuesForRepoFn",t?.accessToken);return this.getPagedResult(s,{repo:r,...t},s.getIssuesForRepoFn,o,t?.cursor)}async getIssuesForAzureProject(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(a.Q7.AzureDevOps,"getIssuesForAzureProjectFn",t?.accessToken);return this.getPagedResult(s,{namespace:e,project:r,...t},s.getIssuesForAzureProjectFn,o,t?.cursor)}async getIssuesForProject(e,r,t,s){let{provider:o,token:u}=await this.ensureProviderTokenAndFunction(e,"getIssuesForProjectFn",s?.accessToken);try{let e=await o.getIssuesForProjectFn?.({projectKey:r,resourceId:t,...s},{token:u});return e?.data}catch(r){return this.handleProviderError(e,u,r)}}async getIssuesForResourceForCurrentUser(e,r,t){let{provider:s,token:o}=await this.ensureProviderTokenAndFunction(e,"getIssuesForResourceForCurrentUserFn",t?.accessToken);try{let e=await s.getIssuesForResourceForCurrentUserFn?.({resourceId:r},{token:o});return e?.data}catch(r){return this.handleProviderError(e,o,r)}}async getIssue(e,r,t,s){let{provider:o,token:u}=await this.ensureProviderTokenAndFunction(e,"getIssueFn",s?.accessToken);try{let e=await o.getIssueFn?.({resourceId:r,number:t},{token:u});return e?.data}catch(r){return this.handleProviderError(e,u,r)}}};async function d(e){let r=e.headers.get("content-type")||"",t=null;if(r.startsWith("application/json")){let r=await e.text();t=r.trim().length>0?JSON.parse(r):null}else if(r.startsWith("text/")||""===r)t=await e.text();else if(r.startsWith("application/vnd.github.raw+json"))t=await e.arrayBuffer();else throw Error(`Unsupported content-type: ${r}`);let s={body:t,headers:Object.fromEntries(e.headers.entries()),status:e.status,statusText:e.statusText};if(!e.ok){let r=Error(e.statusText);throw Object.assign(r,{response:s}),r}return s}}};