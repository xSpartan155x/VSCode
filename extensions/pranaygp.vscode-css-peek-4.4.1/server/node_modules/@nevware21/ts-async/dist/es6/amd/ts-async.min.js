/*!
 * NevWare21 - ts-async, 0.2.6
 * https://github.com/nevware21/ts-async
 * Copyright (c) NevWare21 and contributors. All rights reserved.
 * Licensed under the MIT license.
 */
define(["exports"],function(e){"use strict";const a=void 0,s=null,S="",x="function",$="object",u="prototype",F="__proto__",t="undefined",H="Symbol",J="length",L="name",U="slice",n=Object,W=n[u];var B,G=String,K=Array;const M=K[u];function Q(t){return function(e){return typeof e===t}}function V(e){return W.toString.call(e)}function j(e){return typeof e===t||e===t}const R=Q(x);function X(e){var t;return(e||(t=e)!==s&&!j(t))&&e&&typeof e===$}const Y=K.isArray,Z=Q("number"),ee=function(e){return!(!e||"[object Error]"!==V(e))};function A(e){return e&&R(e.then)}const te=n.getOwnPropertyDescriptor,ne=n.hasOwn||function(e,t){return r=t,(n=e)&&W.hasOwnProperty.call(n,r)||!!te(e,t);var n,r};function r(e,t,n){if(e&&X(e))for(const r in e)if(ne(e,r)&&-1===t.call(n||e,r,e[r]))break}function re(e){throw new TypeError(e)}const oe=n.freeze;function ce(e){return oe&&r(e,(e,t)=>{(Y(t)||X(t))&&oe(t)}),ie(e)}const ie=oe||(e=>e),le=n.getPrototypeOf||(e=>e[F]||s),ue=function(){{var e=ce;let n={};return r({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12},(e,t)=>{n[e]=e,n[t]=e}),e(n)}}(),ae=G,se="__tsUtils$gblCfg";let fe;function ve(){var e;return(e=(e=(e=typeof globalThis!==t?globalThis:void 0)||typeof self===t?e:self)||typeof window===t?e:window)||typeof global===t?e:global}function I(e,t){let n=S;if(ee(e))n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e.name+"'";else try{n=JSON.stringify(e,s,t?Z(t)?t:4:a)}catch(e){n=" - "+I(e,t)}return V(e)+": "+n}function de(r,o,c){return function(e){var t,n=e&&e[r]||o&&o[r];if(n||c)return t=arguments,(n||c).apply(e,n?M[U].call(t,1):t);re("'"+ae(r)+"' not defined for "+I(e))}}let ye={};const o={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"},E=n.defineProperty;function me(e,t,n){E(e,t,function(t){let n={};var e;return n[o.c]=!0,n[o.e]=!0,t.l&&(n.get=()=>t.l.v,e=te(t.l,"v"))&&e.set&&(n.set=e=>{t.l.v=e}),r(t,(e,t)=>{n[o[e]]=j(t)?n[o[e]]:t}),n}(n))}let T,pe=function(){var e;T=(fe||(e=ve()||{},fe=e[se]=e[se]||{}),fe),pe=s};function c(t){let n={};return pe&&pe(),n.b=T.lzy,E(n,"v",{configurable:!0,get:function(){var e=t();return T.lzy||(E(n,"v",{value:e}),n.b&&delete n.b),T.lzy&&n.b!==T.lzy&&(n.b=T.lzy),e}}),n}function k(n,r){return c(()=>{{var t=n;let e=r;try{e=t()}catch(e){}return e}})}const he="window";let i,z,C,ge;function O(e){return k(()=>Pe(e)||a,a)}function be(e){return(i=!i||!1===e||T.lzy&&!i.b?k(ve,s):i).v}function Pe(e,t){t=be(t);return t&&t[e]?t[e]:e===he&&z?z.v:s}let _,we,Se;function je(e){return k(function(){return _.v?_[e]:a},a)}function Re(){var e=!_||T&&T.lzy&&!_.b;return e&&(_=O(H)),we&&!e||(we=je("for")),Se&&!e||(Se=je("keyFor")),_.v}function Ae(t,n,r){if(t){var o=t[J]>>>0;for(let e=0;e<o&&!(e in t&&-1===n.call(r||t,t[e],e,t));e++);}}const Ie=de("indexOf",M),N=de(U,M),Ee=n.create||function(e){if(!e)return{};var t=typeof e;if(t!==$&&t!=x)throw new TypeError("Prototype must be an Object or function: "+I(e));function n(){}return n[u]=e,new n};let Te;function ke(e,t){return(n.setPrototypeOf||function(n,e){(Te=Te||c(()=>({[F]:[]})instanceof Array)).v?n[F]=e:r(e,(e,t)=>n[e]=t)})(e,t)}const ze=(e,t)=>{try{t&&(e[L]=t)}catch(e){}},Ce=(e,t)=>{try{me(e,L,{v:t,c:!0,e:!1})}catch(e){}};function p(){return(Date.now||Oe)()}function Oe(){return(new Date).getTime()}function h(e){return e[B]}B=J;let l;function _e(){var e=(l=!l||T.lzy&&!l.b?O("performance"):l).v;return e&&e.now?e.now():p()}const Ne="unref",De="hasRef",qe="enabled";function xe(e,t,n){let r=!0,o=e?t(s):s,c;const i=()=>(r=!1,o&&o[Ne]&&o[Ne](),c),l=()=>(o=t(o),r||i(),c),u=()=>{o&&n(o),o=s};return c={cancel:u,refresh:l,hasRef:()=>o&&o[De]?o[De]():r,ref:()=>(r=!0,o&&o.ref&&o.ref(),c),unref:i,enabled:!1},E(c,qe,{get:()=>!!o,set:e=>{!e&&o&&u(),e&&!o&&l()}}),{h:c,dn:()=>{o=s}}}function D(){{var o=this,c=a,i=N(arguments),l=Y(c),u=l?c.length:0;let t=(0<u?c[0]:l?a:c)||setTimeout,n=(1<u?c[1]:a)||clearTimeout,e=i[0],r=(i[0]=function(){r.dn(),e.apply(o,arguments)},xe(!0,e=>{if(e){if(e.refresh)return e.refresh(),e;n.call(o,e)}return t.apply(o,i)},function(e){n.call(o,e)}));return r.h}}let $e,Fe=100,He=50;function Je(e,t){return Le(e,e=>{t&&t({value:e,rejected:!1})},e=>{t&&t({rejected:!0,reason:e})})}function Le(e,t,n,r){let o=e;return A(e)?(t||n)&&(o=e.then(t,n)):t&&t(e),o=r?Ue(o,r):o}function Ue(e,t){let n=e;return t&&(A(e)?n=e.finally?e.finally(t):e.then(function(e){return t(),e},function(e){throw t(),e}):t()),n}let We,Be,Ge,Ke=!1;const Me=["pending","resolving","resolved","rejected"],Qe="dispatchEvent";let Ve;const Xe="Promise",Ye="unhandledRejection",Ze=Ye.toLowerCase();let q=[],et=0,tt=10,nt;function rt(e){return R(e)?e.toString():I(e)}function ot(e,t,n){let r=N(arguments,3),i=0,l=!1,u,a=[],s=et++,o=0<q.length?q[q.length-1]:void 0,f=!1,v=null,c;nt=nt||O(Xe+"RejectionEvent");const d=(o,c)=>{try{return q.push(s),f=!0,v&&v.cancel(),v=null,e(function(n,r){a.push(function(){try{var e=2===i?o:c,t=j(e)?u:R(e)?e(u):e;A(t)?t.then(n,r):(e||3!==i?n:r)(t)}catch(e){r(e)}}),l&&b()},r)}finally{q.pop()}};var y,m,p,h;const g=()=>Me[i],b=()=>{var e;0<a.length&&(e=a.slice(),a=[],f=!0,t(e),v&&v.cancel(),v=null)},P=(t,n)=>e=>{i===n&&(2===t&&A(e)?(i=1,e.then(P(2,1),P(3,1))):(i=t,l=!0,u=e,b(),f||3!==t||(v=v||D(w,tt))))},w=()=>{if(!f)if((ge=ge||k(()=>!(!process||!(process.versions||{}).node),!1)).v)process.emit(Ye,u,c);else{var e=(z=!z||T.lzy&&!z.b?O(he):z).v||be(),n=Ze,r=e=>(me(e,"promise",{g:()=>c}),e.reason=u,e),o=!!nt.v;let t=(C=!C||T.lzy&&!C.b?O("document"):C).v;o=(Ve=Ve||k(()=>{var e;return!!(e=t&&t.createEvent?t.createEvent("Event"):void 0)&&e.initEvent},null)).v?t.createEvent("Event"):o?new Event(n):{};r(o),Ve.v&&o.initEvent(n,!1,!0),o&&e[Qe]?e[Qe](o):(r=e["on"+n])?r(o):(e=Pe("console"))&&(e.error||e.log)(n,I(o))}};c={then:d,catch:e=>d(void 0,e),finally:t=>{let e=t,n=t;return R(t)&&(e=function(e){return t&&t(),e},n=function(e){throw t&&t(),e}),d(e,n)}},E(c,"state",{get:g}),Ke&&(S=c,m=g,h=()=>V(u),y=()=>f,We=We||{toString:()=>"[[PromiseState]]"},Be=Be||{toString:()=>"[[PromiseResult]]"},Ge=Ge||{toString:()=>"[[PromiseIsHandled]]"},E(S,We,{get:m}),E(S,Be,{get:h}),E(S,Ge,{get:y})),Re()&&(c[m=ue[11],_&&(!T.lzy||_.b)||Re(),_.v?_.v[m||11]:(h=ue[11])?ye[h]=ye[h]||(p=H+"."+h,{description:ae(p),toString:()=>H+"("+p+")",_polyfill:!0}):void 0]="IPromise"),c.toString=()=>"IPromise"+(Ke?"["+s+(j(o)?"":":"+o)+"]":"")+" "+g()+(l?" - "+rt(u):""),R(n)||re(Xe+": executor is not a function - "+rt(n));var S=P(3,0);try{n.call(c,P(2,0),S)}catch(e){S(e)}return c}function f(n){return function(e){var t=N(arguments,1);return n((o,c)=>{try{let n=[],r=1;Ae(e,(e,t)=>{e&&(r++,Le(e,e=>{n[t]=e,0==--r&&o(n)},c))}),0==--r&&o(n)}catch(e){c(e)}},t)}}function v(n){return function(t){var e=N(arguments,1);return A(t)?t:n(e=>{e(t)},e)}}function d(t){return function(n){var e=N(arguments,1);return t((e,t)=>{t(n)},e)}}const ct=e=>{Ae(e,e=>{try{e()}catch(e){}})};function y(e,t){return ot(y,function(e){let t=Z(e)?e:0;return e=>{D(()=>{ct(e)},t)}}(t),e,t)}var K=f(y),G=v(y),it=d(y);let lt;function m(e,t){var n=(lt=lt||O(Xe)).v;if(!n)return y(e);R(e)||re(Xe+": executor is not a function - "+I(e));let r=0;n=new n((t,n)=>{e(function(e){r=2,t(e)},function(e){r=3,n(e)})});return E(n,"state",{get:function(){return Me[r]}}),n}var ut=f(m),at=v(m),st=d(m);function g(e){return ot(g,ct,e)}var ft=f(g),vt=v(g),dt=d(g);let yt;function b(e,t){var n=j(t)?yt:t;return ot(b,function(){let c;return 0<=n&&(c={timeout:+n}),t=>{var n=e=>{ct(t)},r=c;function o(e){let t=_e();return{didTimeout:e,timeRemaining:()=>{return He-(e=t,_e()-e);var e}}}if(($e=$e||k(()=>{return!!(e=requestIdleCallback)||e!==a;var e},!1)).v&&requestIdleCallback){let t=xe(!0,e=>(e&&cancelIdleCallback(e),requestIdleCallback(e=>{t.dn(),n(e||o(!1))},r)),e=>{cancelIdleCallback(e)});void t.h}else{var e=(r||{}).timeout;D(()=>{n(o(!0))},j(e)?Fe:e)}}}(),e,n)}var mt=f(b),pt=v(b),ht=d(b);let gt;function P(e,t){return(gt=gt||c(()=>m)).v.call(this,e,t)}var bt=f(P),Pt=v(P),wt=d(P);const w="reject",St="Rejected";let jt=0,Rt,At,It={};const Et=()=>{};var Tt=(e,t,n)=>{It[e]||(It[e]=function(r){let o=Error,c=o[u][L],i=Error.captureStackTrace;return t=r,n=function(){var e=this;try{ze(o,r);var t,n=o.apply(e,arguments)||e;return n!==e&&(t=le(e))!==le(n)&&ke(n,t),i&&i(n,e.constructor),n}finally{ze(o,c)}},l=o,Ce(n,t),(n=ke(n,l))[u]=l===s?Ee(l):(e[u]=l[u],new e),n;function e(){this.constructor=n,Ce(this,t)}var t,n,l}(e));var r=p();return new It[e](`Task [${t.id}] ${n||""}- ${t.st?"Running":"Waiting"}: `+(r-(t.st||t.cr)||"0")+" ms")};function kt(e,t){let n=p()-t;Ae(e,e=>{(e&&!e.rj&&e.st&&e.st<n||!e.st&&e.cr&&e.cr<n)&&e&&e[w](e.rj||Tt("Aborted",e,"Stale "))})}function zt(e,t){t=Ie(e,t);-1!==t&&e.splice(t,1)}e.createAllPromise=bt,e.createAsyncAllPromise=K,e.createAsyncPromise=y,e.createAsyncRejectedPromise=it,e.createAsyncResolvedPromise=G,e.createIdleAllPromise=mt,e.createIdlePromise=b,e.createIdleRejectedPromise=ht,e.createIdleResolvedPromise=pt,e.createNativeAllPromise=ut,e.createNativePromise=m,e.createNativeRejectedPromise=st,e.createNativeResolvedPromise=at,e.createPromise=P,e.createRejectedPromise=wt,e.createResolvedPromise=Pt,e.createSyncAllPromise=ft,e.createSyncPromise=g,e.createSyncRejectedPromise=dt,e.createSyncResolvedPromise=vt,e.createTaskScheduler=function(u,e){let a,t=[],s=[],n,r,f=0,v=(e?e+".":"")+jt++,o;u=u||P;const d=()=>{var e=0<h(t)+h(s);0<n&&(o||(o=D(()=>{kt(t,n),kt(s,n),o&&(o.enabled=0<h(t)+h(s))},r)).unref(),o)&&(o.enabled=e)},y=(c,i)=>(c.st=p(),t.push(c),d(),(t,n)=>{const r=e=>{c.rj=c.rj||e||Tt(St,c),c[w]=Et,l(c),t=null,n&&n(e),n=null};var e=c.id;if(c.rj)r(c.rj);else{c[w]=r;try{var o=i(e);c.to&&A(o)&&(c.t=D(()=>{r(Tt("Timeout",c))},c.to)),Le(o,e=>{l(c),n=null,t&&t(e),t=null},r)}catch(e){r(e)}}}),l=e=>{zt(t,e),e.t&&e.t.cancel(),e.t=null,a&&a===e&&(a=null,h(t)+h(s)===0)&&(o&&o.cancel(),o=null)};var c,i,m,e={idle:!0,queue:(e,t,n)=>{let r=v+"."+f++,o=(t&&(r+="-("+t+")"),{id:r,cr:p(),to:n,[w]:e=>{o.rj=e||Tt(St,o),o[w]=Et}});var c,i,l;return a?o.p=(c=o,i=a,l=e,s.push(c),d(),u((e,t)=>{c.id,i.id,Je(i.p,()=>{zt(s,c),y(c,l)(e,t)})})):o.p=u(y(o,e)),(a=o).p},setStaleTimeout:(e,t)=>{o&&o.cancel(),o=null,n=e,r=t||e/10,d()}};return me(e,"idle",{g:()=>h(t)+h(s)===0}),c=e,i=()=>v,m=()=>({l:a,r:t,w:s}),Rt=Rt||{toString:()=>"[[SchedulerName]]"},At=At||{toString:()=>"[[SchedulerState]]"},E(c,Rt,{get:i}),E(c,At,{get:m}),e},e.doAwait=Le,e.doAwaitResponse=Je,e.doFinally=Ue,e.setCreatePromiseImpl=function(e){gt=e?c(()=>e):null},e.setDetaultIdleTimeout=function(e){yt=e},e.setPromiseDebugState=function(e,t){Ke=e}});
//# sourceMappingURL=ts-async.min.js.map
